# 固件烧录工具 Impeller
[Impeller]: http://10.23.10.196:19000/web-file/tools/Impeller_COMMON.7z

## 简介
Impeller工具是思澈科技芯片平台用于产线的烧录校准工具，也可做为日常的烧录工具使用。本工具运行于windows系统，无需安装，打开Impeller.exe可直接使用。工具提供功能如下：
* 固件IMG 烧录
* MAC/SN等信息生成及烧录
* 48M晶体校准、电池测量校准
* FLASH 擦除
* 支持16个通道并行处理
* 支持UART和JLINK SWD两种方式（建议使用串口方式）

工具详细使用说明参考Impeller工具包中doc文件夹下“Impeller使用说明.pdf”，此处只描述烧录的操作步骤。

## 工具下载
点击下载 [Impeller工具包][Impeller]

## 烧录环境
硬件环境：PC+硬件开发板+Type-C USB线；\
软件环境：Windows系统+Impeller工具+固件包；

## SF32LB5x-LCD开发板烧录步骤
如图所示为SF32LB5x-LCD开发板实物正面图：
```{figure} assets/烧录流程_1.png
:align: center
:scale: 58%
```
\
1）通过连接开发板①②对应插针将bootmode拉高，这样开发板启动会进入boot模式；\
2）开发板③④两处插针必须用跳线帽连接，确保下载串口连接正常；\
3）用Type-C USB线连接开发板⑤对应的USB接口到PC上；\
4）打开⑥对应开关，拨到“开”位置，此时电源指示灯⑦会亮，且在PC设备管理器可以看到有串口号枚举出来；\
5）打开Impeller工具，按照下图所示进行烧录：
```{figure} assets/烧录流程_3.png
:align: center
:scale: 70%
```
\
上图中步骤1）的参数设置页面具体设置如下图：
```{figure} assets/烧录流程_4.png
:align: center
:scale: 70%
```
\
6）注意：下载成功后，将开发板①②对应插针断开，重新上电可正常启动；


## SF32LB52-DevKit-LCD开发板烧录步骤
如图所示为SF32LB52-DevKit-LCD开发板实物正面图：
```{figure} assets/烧录流程_2.png
:align: center
:scale: 80%
```
\
1）用Type-C USB线连接开发板①对应的USB接口到PC上，此时电源指示灯②会亮，且在PC设备管理器可以看到有串口号枚举出来；\
2）打开Impeller工具，按照下图所示进行烧录：
```{figure} assets/烧录流程_5.png
:align: center
:scale: 70%
```
\
上图中步骤5）中的开发板复位通过按开发板复位键③来实现\
上图中步骤1）的参数设置页面具体设置如下图：
```{figure} assets/烧录流程_6.png
:align: center
:scale: 70%
```
\

注意：52x平台无bootmode管脚，进入boot模式是工具通过串口命令来处理的，所以工具在处于监控模式时会占用烧录串口。上面流程中使用的是单次监控模式，即启动烧录后监控到开发板启动就会执行烧录，完成后会释放串口；如果一直未监控到开发板启动，会一直占用串口，需要手动点击工具"停止"按钮退出监控模式。

## 常见问题及建议
Q1: 板子连接到PC上但是没有串口号枚举出来
* 确认Type-C USB线是否带有数据传输功能或是否损坏
* 确认Type-C USB线连接开发板的端口是否正确，参考烧录步骤中描述
* 老的windows系统可能要安装驱动，开发板上的USB转串口芯片是WCH的CH34X系列

Q2: PC上有串口枚举出来但是Impeller工具上无法显示
* 确认Impeller工具的参数设置页面，选择的"接口"类型是UART，且“端口指定”未勾选
* 点击工具的“扫描”按钮，重新扫描端口

Q3: Impeller参数设置界面粘贴固件路径后文件列表是空的
* 确认粘贴的路径是否正确，以及路径下面是否存在downfile.ini或ImgBurnList.ini文件，如不存在或者文件内容为空请联系固件包提供人员确认

Q4: 启动烧录很快（8秒内）显示失败
* 确认该串口是否被其他软件打开占用，烧录时其他软件不能占用该串口
* 确认选择的通道对应的串口是否开发板枚举出来的端口

Q5: 烧录过程中有规律的失败，如固定下载到20%时失败
* 进入Impeller参数设置界面，看下载文件列表的下载地址是否有超出开发板地址范围，即确认固件包是否同开发板匹配
* Impeller工具目录下log/channel/日期文件夹下面有烧录的log保存，可简单看最后的打印信息，或者直接咨询FAE解决，一般情况是外接的FLASH等焊接异常、供电控制异常、驱动不支持等

Q6: 烧录不稳定，有时正常，有时失败
* 确保烧录操作是完全按照上面要求的烧录步骤执行
* 排查Type-C USB线是否有损坏或者开发板USB接口是否有松动现象
* Impeller参数设置界面，将串口波特率降为1000000，看是否能恢复正常
